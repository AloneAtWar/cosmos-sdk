# 模块参考

<cite>
**本文档中引用的文件**  
- [auth.go](file://proto\cosmos\auth\v1beta1\tx.proto)
- [auth_query.proto](file://proto\cosmos\auth\v1beta1\query.proto)
- [bank.proto](file://proto\cosmos\bank\v1beta1\tx.proto)
- [bank_query.proto](file://proto\cosmos\bank\v1beta1\query.proto)
- [staking.proto](file://proto\cosmos\staking\v1beta1\tx.proto)
- [staking_query.proto](file://proto\cosmos\staking\v1beta1\query.proto)
- [gov.proto](file://proto\cosmos\gov\v1beta1\tx.proto)
- [gov_query.proto](file://proto\cosmos\gov\v1beta1\query.proto)
- [distribution.proto](file://proto\cosmos\distribution\v1beta1\tx.proto)
- [distribution_query.proto](file://proto\cosmos\distribution\v1beta1\query.proto)
</cite>

## 目录
1. [简介](#简介)
2. [账户模块 (auth)](#账户模块-auth)
3. [银行模块 (bank)](#银行模块-bank)
4. [质押模块 (staking)](#质押模块-staking)
5. [治理模块 (gov)](#治理模块-gov)
6. [分配模块 (distribution)](#分配模块-distribution)
7. [模块交互](#模块交互)

## 简介
Cosmos SDK 提供了一组预定义的模块，用于构建区块链应用程序。这些模块提供了账户管理、代币转账、质押、治理和奖励分配等核心功能。每个模块都通过 gRPC API 提供查询服务，并定义了用于执行状态变更的消息类型（Msg）。本文档详细介绍了这些核心模块的功能、API 端点和消息类型。

## 账户模块 (auth)

`auth` 模块负责管理账户系统，包括账户创建、查询和参数配置。它为区块链上的所有实体（用户和模块）提供身份基础。

### 核心功能
- 管理所有账户的创建和查询
- 提供账户地址和账户编号之间的转换
- 管理模块账户（由模块拥有的特殊账户）
- 提供 Bech32 地址前缀信息

### gRPC API 端点
`auth` 模块的查询服务定义在 `proto/cosmos/auth/v1beta1/query.proto` 文件中。

- **Accounts**: 查询所有现有账户。
  - HTTP: `GET /cosmos/auth/v1beta1/accounts`
  - 请求: `QueryAccountsRequest`
  - 响应: `QueryAccountsResponse` (包含 `google.protobuf.Any` 类型的账户列表)

- **Account**: 根据地址查询账户详情。
  - HTTP: `GET /cosmos/auth/v1beta1/accounts/{address}`
  - 请求: `QueryAccountRequest` (包含 `address` 字段)
  - 响应: `QueryAccountResponse` (包含 `google.protobuf.Any` 类型的账户)

- **Params**: 查询模块的所有参数。
  - HTTP: `GET /cosmos/auth/v1beta1/params`
  - 请求: `QueryParamsRequest` (空消息)
  - 响应: `QueryParamsResponse` (包含 `Params` 消息)

- **ModuleAccounts**: 查询所有现有的模块账户。
  - HTTP: `GET /cosmos/auth/v1beta1/module_accounts`
  - 请求: `QueryModuleAccountsRequest` (空消息)
  - 响应: `QueryModuleAccountsResponse` (包含 `google.protobuf.Any` 类型的模块账户列表)

- **ModuleAccountByName**: 根据模块名称查询模块账户信息。
  - HTTP: `GET /cosmos/auth/v1beta1/module_accounts/{name}`
  - 请求: `QueryModuleAccountByNameRequest` (包含 `name` 字段)
  - 响应: `QueryModuleAccountByNameResponse` (包含 `google.protobuf.Any` 类型的模块账户)

**Section sources**
- [auth_query.proto](file://proto\cosmos\auth\v1beta1\query.proto#L14-L82)

### 消息类型 (Msg)
`auth` 模块本身不定义用于状态变更的交易消息（Msg），它主要提供基础账户功能供其他模块使用。

## 银行模块 (bank)

`bank` 模块负责代币的转账和余额管理。它是处理代币移动的核心模块。

### 核心功能
- 在账户之间转移代币
- 查询单个或所有代币的余额
- 管理代币的总供应量和元数据
- 控制代币的发送权限

### gRPC API 端点
`bank` 模块的查询服务定义在 `proto/cosmos/bank/v1beta1/query.proto` 文件中。

- **Balance**: 查询单个账户对单个代币的余额。
  - HTTP: `GET /cosmos/bank/v1beta1/balances/{address}/by_denom`
  - 请求: `QueryBalanceRequest` (包含 `address` 和 `denom` 字段)
  - 响应: `QueryBalanceResponse` (包含 `cosmos.base.v1beta1.Coin` 类型的余额)

- **AllBalances**: 查询单个账户对所有代币的余额。
  - HTTP: `GET /cosmos/bank/v1beta1/balances/{address}`
  - 请求: `QueryAllBalancesRequest` (包含 `address` 和可选的 `pagination`)
  - 响应: `QueryAllBalancesResponse` (包含 `cosmos.base.v1beta1.Coin` 类型的余额列表)

- **TotalSupply**: 查询所有代币的总供应量。
  - HTTP: `GET /cosmos/bank/v1beta1/supply`
  - 请求: `QueryTotalSupplyRequest` (包含可选的 `pagination`)
  - 响应: `QueryTotalSupplyResponse` (包含 `cosmos.base.v1beta1.Coin` 类型的供应量列表)

- **SupplyOf**: 查询单个代币的供应量。
  - HTTP: `GET /cosmos/bank/v1beta1/supply/by_denom`
  - 请求: `QuerySupplyOfRequest` (包含 `denom` 字段)
  - 响应: `QuerySupplyOfResponse` (包含 `cosmos.base.v1beta1.Coin` 类型的供应量)

- **Params**: 查询模块的参数。
  - HTTP: `GET /cosmos/bank/v1beta1/params`
  - 请求: `QueryParamsRequest` (空消息)
  - 响应: `QueryParamsResponse` (包含 `Params` 消息)

- **DenomMetadata**: 查询特定代币面额的客户端元数据。
  - HTTP: `GET /cosmos/bank/v1beta1/denoms_metadata/{denom=**}`
  - 请求: `QueryDenomMetadataRequest` (包含 `denom` 字段)
  - 响应: `QueryDenomMetadataResponse` (包含 `Metadata` 消息)

**Section sources**
- [bank_query.proto](file://proto\cosmos\bank\v1beta1\query.proto#L15-L127)

### 消息类型 (Msg)
`bank` 模块的交易消息定义在 `proto/cosmos/bank/v1beta1/tx.proto` 文件中。

- **MsgSend**: 从一个账户向另一个账户发送代币。
  - 请求: `MsgSend` (包含 `from_address`, `to_address`, `amount`)
- **MsgMultiSend**: 执行多个发送操作的原子交易。
  - 请求: `MsgMultiSend` (包含 `inputs`, `outputs` 列表)

## 质押模块 (staking)

`staking` 模块负责权益证明（PoS）机制中的质押、委托和验证器管理。

### 核心功能
- 创建和管理验证器
- 允许代币持有者委托给验证器
- 管理委托、解委托和再委托
- 维护验证器集和质押池

### gRPC API 端点
`staking` 模块的查询服务定义在 `proto/cosmos/staking/v1beta1/query.proto` 文件中。

- **Validators**: 查询所有匹配给定状态的验证器。
  - HTTP: `GET /cosmos/staking/v1beta1/validators`
  - 请求: `QueryValidatorsRequest` (包含 `status` 和可选的 `pagination`)
  - 响应: `QueryValidatorsResponse` (包含 `Validator` 类型的验证器列表)

- **Validator**: 根据地址查询验证器信息。
  - HTTP: `GET /cosmos/staking/v1beta1/validators/{validator_addr}`
  - 请求: `QueryValidatorRequest` (包含 `validator_addr`)
  - 响应: `QueryValidatorResponse` (包含 `Validator` 消息)

- **Delegation**: 查询委托者和验证器对的委托信息。
  - HTTP: `GET /cosmos/staking/v1beta1/validators/{validator_addr}/delegations/{delegator_addr}`
  - 请求: `QueryDelegationRequest` (包含 `delegator_addr`, `validator_addr`)
  - 响应: `QueryDelegationResponse` (包含 `DelegationResponse` 消息)

- **DelegatorDelegations**: 查询委托者的所有委托。
  - HTTP: `GET /cosmos/staking/v1beta1/delegations/{delegator_addr}`
  - 请求: `QueryDelegatorDelegationsRequest` (包含 `delegator_addr` 和可选的 `pagination`)
  - 响应: `QueryDelegatorDelegationsResponse` (包含 `DelegationResponse` 列表)

- **Pool**: 查询质押池信息（总质押代币）。
  - HTTP: `GET /cosmos/staking/v1beta1/pool`
  - 请求: `QueryPoolRequest` (空消息)
  - 响应: `QueryPoolResponse` (包含 `Pool` 消息)

- **Params**: 查询模块的参数。
  - HTTP: `GET /cosmos/staking/v1beta1/params`
  - 请求: `QueryParamsRequest` (空消息)
  - 响应: `QueryParamsResponse` (包含 `Params` 消息)

**Section sources**
- [staking_query.proto](file://proto\cosmos\staking\v1beta1\query.proto#L14-L131)

### 消息类型 (Msg)
`staking` 模块的交易消息定义在 `proto/cosmos/staking/v1beta1/tx.proto` 文件中。

- **MsgCreateValidator**: 创建一个新的验证器。
  - 请求: `MsgCreateValidator` (包含 `description`, `commission`, `min_self_delegation`, `delegator_address`, `validator_address`, `pubkey`, `value`)
- **MsgDelegate**: 向验证器委托代币。
  - 请求: `MsgDelegate` (包含 `delegator_address`, `validator_address`, `amount`)
- **MsgUndelegate**: 从验证器解委托代币。
  - 请求: `MsgUndelegate` (包含 `delegator_address`, `validator_address`, `amount`)
- **MsgBeginRedelegate**: 开始将委托从一个验证器再委托到另一个验证器。
  - 请求: `MsgBeginRedelegate` (包含 `delegator_address`, `validator_src_address`, `validator_dst_address`, `amount`)

## 治理模块 (gov)

`gov` 模块负责链上治理，允许代币持有者对提案进行投票。

### 核心功能
- 创建和管理治理提案
- 接收和处理投票
- 处理提案的存款
- 根据投票结果执行提案

### gRPC API 端点
`gov` 模块的查询服务定义在 `proto/cosmos/gov/v1beta1/query.proto` 文件中。

- **Proposal**: 根据提案ID查询提案详情。
  - HTTP: `GET /cosmos/gov/v1beta1/proposals/{proposal_id}`
  - 请求: `QueryProposalRequest` (包含 `proposal_id`)
  - 响应: `QueryProposalResponse` (包含 `Proposal` 消息)

- **Proposals**: 根据状态查询所有提案。
  - HTTP: `GET /cosmos/gov/v1beta1/proposals`
  - 请求: `QueryProposalsRequest` (包含可选的 `proposal_status`, `voter`, `depositor`, `pagination`)
  - 响应: `QueryProposalsResponse` (包含 `Proposal` 列表)

- **Vote**: 查询特定提案和投票者的投票信息。
  - HTTP: `GET /cosmos/gov/v1beta1/proposals/{proposal_id}/votes/{voter}`
  - 请求: `QueryVoteRequest` (包含 `proposal_id`, `voter`)
  - 响应: `QueryVoteResponse` (包含 `Vote` 消息)

- **Votes**: 查询特定提案的所有投票。
  - HTTP: `GET /cosmos/gov/v1beta1/proposals/{proposal_id}/votes`
  - 请求: `QueryVotesRequest` (包含 `proposal_id` 和可选的 `pagination`)
  - 响应: `QueryVotesResponse` (包含 `Vote` 列表)

- **Params**: 查询治理参数（投票、存款、计票）。
  - HTTP: `GET /cosmos/gov/v1beta1/params/{params_type}`
  - 请求: `QueryParamsRequest` (包含 `params_type` 字段)
  - 响应: `QueryParamsResponse` (包含 `VotingParams`, `DepositParams`, `TallyParams`)

- **Deposit**: 查询特定提案和存款人的存款信息。
  - HTTP: `GET /cosmos/gov/v1beta1/proposals/{proposal_id}/deposits/{depositor}`
  - 请求: `QueryDepositRequest` (包含 `proposal_id`, `depositor`)
  - 响应: `QueryDepositResponse` (包含 `Deposit` 消息)

**Section sources**
- [gov_query.proto](file://proto\cosmos\gov\v1beta1\query.proto#L13-L54)

### 消息类型 (Msg)
`gov` 模块的交易消息定义在 `proto/cosmos/gov/v1beta1/tx.proto` 文件中。

- **MsgSubmitProposal**: 提交一个新的治理提案。
  - 请求: `MsgSubmitProposal` (包含 `content`, `initial_deposit`, `proposer`)
- **MsgVote**: 对提案进行投票。
  - 请求: `MsgVote` (包含 `proposal_id`, `voter`, `option`)
- **MsgVoteWeighted**: 对提案进行加权投票。
  - 请求: `MsgVoteWeighted` (包含 `proposal_id`, `voter`, `options`)
- **MsgDeposit**: 为提案增加存款。
  - 请求: `MsgDeposit` (包含 `proposal_id`, `depositor`, `amount`)

## 分配模块 (distribution)

`distribution` 模块负责处理交易费用和区块奖励的分配，以及验证器的佣金管理。

### 核心功能
- 分配交易费用和区块奖励给验证器和委托者
- 管理验证器的佣金
- 维护社区资金池
- 处理奖励的提取

### gRPC API 端点
`distribution` 模块的查询服务定义在 `proto/cosmos/distribution/v1beta1/query.proto` 文件中。

- **Params**: 查询模块的参数。
  - HTTP: `GET /cosmos/distribution/v1beta1/params`
  - 请求: `QueryParamsRequest` (空消息)
  - 响应: `QueryParamsResponse` (包含 `Params` 消息)

- **ValidatorDistributionInfo**: 查询验证器的佣金和自委托奖励。
  - HTTP: `GET /cosmos/distribution/v1beta1/validators/{validator_address}`
  - 请求: `QueryValidatorDistributionInfoRequest` (包含 `validator_address`)
  - 响应: `QueryValidatorDistributionInfoResponse` (包含 `operator_address`, `self_bond_rewards`, `commission`)

- **DelegationRewards**: 查询委托给特定验证器的总奖励。
  - HTTP: `GET /cosmos/distribution/v1beta1/delegators/{delegator_address}/rewards/{validator_address}`
  - 请求: `QueryDelegationRewardsRequest` (包含 `delegator_address`, `validator_address`)
  - 响应: `QueryDelegationRewardsResponse` (包含 `rewards` 列表)

- **DelegationTotalRewards**: 查询委托者从所有验证器获得的总奖励。
  - HTTP: `GET /cosmos/distribution/v1beta1/delegators/{delegator_address}/rewards`
  - 请求: `QueryDelegationTotalRewardsRequest` (包含 `delegator_address`)
  - 响应: `QueryDelegationTotalRewardsResponse` (包含 `rewards` 列表和 `total`)

- **DelegatorWithdrawAddress**: 查询委托者的奖励提取地址。
  - HTTP: `GET /cosmos/distribution/v1beta1/delegators/{delegator_address}/withdraw_address`
  - 请求: `QueryDelegatorWithdrawAddressRequest` (包含 `delegator_address`)
  - 响应: `QueryDelegatorWithdrawAddressResponse` (包含 `withdraw_address`)

- **CommunityPool**: 查询社区资金池的代币。
  - HTTP: `GET /cosmos/distribution/v1beta1/community_pool`
  - 请求: `QueryCommunityPoolRequest` (空消息)
  - 响应: `QueryCommunityPoolResponse` (包含 `pool` 列表)

**Section sources**
- [distribution_query.proto](file://proto\cosmos\distribution\v1beta1\query.proto#L14-L75)

### 消息类型 (Msg)
`distribution` 模块的交易消息定义在 `proto/cosmos/distribution/v1beta1/tx.proto` 文件中。

- **MsgSetWithdrawAddress**: 设置委托者的奖励提取地址。
  - 请求: `MsgSetWithdrawAddress` (包含 `delegator_address`, `withdraw_address`)
- **MsgWithdrawDelegatorReward**: 提取委托者从特定验证器获得的奖励。
  - 请求: `MsgWithdrawDelegatorReward` (包含 `delegator_address`, `validator_address`)
- **MsgWithdrawValidatorCommission**: 提取验证器的佣金。
  - 请求: `MsgWithdrawValidatorCommission` (包含 `validator_address`)
- **MsgFundCommunityPool**: 向社区资金池捐赠代币。
  - 请求: `MsgFundCommunityPool` (包含 `amount`, `depositor`)

## 模块交互
Cosmos SDK 的模块通过预定义的接口和共享状态进行交互。

- **`staking` 与 `auth` 和 `bank` 的交互**:
  - `staking` 模块依赖 `auth` 模块来验证交易签名和管理账户。
  - 当用户进行委托（`MsgDelegate`）时，`staking` 模块会调用 `bank` 模块的转账功能，将代币从委托者的账户转移到质押池中。
  - 当用户提取奖励时，`distribution` 模块会调用 `bank` 模块将奖励代币发送到用户的账户。

- **`gov` 与 `bank` 的交互**:
  - 提交治理提案（`MsgSubmitProposal`）需要支付存款，这笔存款由 `gov` 模块接收，但实际的代币转账由 `bank` 模块处理。

- **`distribution` 与 `staking` 和 `bank` 的交互**:
  - `distribution` 模块从 `staking` 模块获取验证器和委托者的信息，以计算应分配的奖励。
  - 计算出奖励后，`distribution` 模块调用 `bank` 模块的功能将奖励代币实际转移到用户账户。

这些模块通过清晰的边界和接口协同工作，共同构成了一个功能完整的区块链应用框架。

**Section sources**
- [auth.go](file://proto\cosmos\auth\v1beta1\tx.proto)
- [bank.proto](file://proto\cosmos\bank\v1beta1\tx.proto)
- [staking.proto](file://proto\cosmos\staking\v1beta1\tx.proto)
- [distribution.proto](file://proto\cosmos\distribution\v1beta1\tx.proto)